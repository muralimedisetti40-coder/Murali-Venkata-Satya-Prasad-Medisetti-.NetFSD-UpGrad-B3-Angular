<!DOCTYPE html>
<html>
    <head>
        <title>Expense Tracker</title>

    </head>
    <body>
        <h1>Expense Tracker </h1>
        <label for="in1">Expense name</label>
        <input type="text" id="in1" placeholder="enter the expense name">
        <label for="amout">amout</label>
        <input type="number" id="amout" placeholder="enter amount">
        <label for="date">date</label>
        <input type="date" id="date">
        <button onclick="openDB()">Open DB</button>
        <button onclick="addExpense()">Create</button>
        <button onclick="viewExpenses()">Read</button>
        <button onclick="deleteExpense()">Delete</button>
        <ul id="output"></ul>

        <script>
let db;

// Open Database
function openDB() {
    let request = indexedDB.open("expensedb", 1);

    request.onupgradeneeded = function(e) {
        db = e.target.result;

        let store = db.createObjectStore("expenses", {
            keyPath: "id",
            autoIncrement: true
        });

        store.createIndex("expenseName", "expenseName", { unique: false });
        store.createIndex("amount", "amount", { unique: false });
        store.createIndex("date", "date", { unique: false });
    };

    request.onsuccess = function(e) {
        db = e.target.result;
        alert("Database Ready");
    };

    request.onerror = function() {
        console.log("Error opening DB");
    };
}

// CREATE
function addExpense() {
    let name = document.getElementById("in1").value;
    let amount = document.getElementById("amout").value;
    let date = document.getElementById("date").value;

    let transaction = db.transaction("expenses", "readwrite");
    let store = transaction.objectStore("expenses");

    let expense = {
        expenseName: name,
        amount: amount,
        date: date
    };

    store.add(expense);

    alert("Expense Added!");
    viewExpenses();
}

// READ
function viewExpenses() {

    if (!db) {
        alert("Database not ready!");
        return;
    }

    let transaction = db.transaction("expenses", "readonly");
    let store = transaction.objectStore("expenses");

    let request = store.getAll();

    request.onsuccess = function() {

        let result = request.result;
        let list = document.getElementById("output");

        list.innerHTML = ""; 

        result.forEach(function(item) {

            let li = document.createElement("li");

            li.textContent =
                "ID: " + item.id +
                " | Expense Name: " + item.expenseName +
                " | Amount: " + item.amount +
                " | Date: " + item.date;

            list.appendChild(li);
        });
    };
}

// DELETE (delete by ID)
function deleteExpense() {
    let id = prompt("Enter ID to delete:");

    let transaction = db.transaction(["expenses"], "readwrite");
    let store = transaction.objectStore("expenses");

    store.delete(Number(id));

    alert("Deleted!");
}
</script>
    </body>
</html>